# Ratify Helm Chart

## Get Repo Info

```console
helm repo add ratify https://ratify-project.github.io/ratify
helm repo update
```

_See [helm repo](https://helm.sh/docs/helm/helm_repo/) for command documentation._

## Install Chart

```console
# Helm install with gatekeeper-system namespace already created
$ helm install [RELEASE_NAME] ratify/ratify --atomic --namespace gatekeeper-system --set featureFlags.RATIFY_CERT_ROTATION=true

# Helm install and create namespace
$ helm install [RELEASE_NAME] ratify/ratify --atomic --namespace gatekeeper-system --create-namespace --set featureFlags.RATIFY_CERT_ROTATION=true

```

_See [parameters](#parameters) below._

_See [helm install](https://helm.sh/docs/helm/helm_install/) for command documentation._

## Upgrade Chart

```console
$ helm upgrade -n gatekeeper-system [RELEASE_NAME] ratify/ratify
```

## Deprecation Policy

Values marked `# DEPRECATED` in the `values.yaml` as well as **DEPRECATED** in the below parameters will NOT be supported in the next major version release. Existing functionality will remain backwards compatible until the next major version release.

## Parameters

| Parameter                                          | Description                                                                                                                                                                                                                                                                                                                                                            | Default                              |
| -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| image.repository                                   | Ratify app image                                                                                                                                                                                                                                                                                                                                                       | `ghcr.io/ratify-project/ratify`      |
| image.crdrepository                                | Ratify CRD install Image                                                                                                                                                                                                                                                                                                                                               | `ghcr.io/ratify-project/ratify-crds` |
| image.tag                                          | Image tag                                                                                                                                                                                                                                                                                                                                                              | `<INSERT THE LATEST RELEASE TAG>`    |
| image.pullPolicy                                   | Image pull policy                                                                                                                                                                                                                                                                                                                                                      | `IfNotPresent`                       |
| nameOverride                                       | Overrides the ratify.name used to determine the ratify full name template                                                                                                                                                                                                                                                                                              | ``                                   |
| fullnameOverride                                   | Overrides the ratify applicaiton full name template                                                                                                                                                                                                                                                                                                                    | ``                                   |
| replicaCount                                       | The number of Ratify replicas in deployment                                                                                                                                                                                                                                                                                                                            | 1                                    |
| affinity                                           | Pod affinity for the Ratify deployment                                                                                                                                                                                                                                                                                                                                 | `{}`                                 |
| tolerations                                        | Pod tolerations for the Ratify deployment                                                                                                                                                                                                                                                                                                                              | `[]`                                 |
| env                                                | Environment variables for Ratify container                                                                                                                                                                                                                                                                                                                             | `[]`                                 |
| notationCerts                                      | An array of public certificate/certificate chain used to create inline certstore used by Notation verifier                                                                                                                                                                                                                                                             | ``                                   |
| cosignKeys                                         | An array of public keys used to create inline key management providers used by Cosign verifier                                                                                                                                                                                                                                                                         | `[]`                                 |
| notation.enabled                                   | Enables/disables the built-in notation verifier. MUST be set to true for notation verification.                                                                                                                                                                                                                                                                        | `true`                               |
| notation.trustPolicies                             | An array of trustPolicies. Each [trustPolicy](https://github.com/notaryproject/specifications/blob/main/specs/trust-store-trust-policy.md#trust-policy-properties:~:text=Trust%20Policy%20Properties) must define the following three attributes: `registryScopes`, `trustedIdentities`, `trustStores`                                                                 | []                                   |
| notation.trustPolicies[0].registryScopes           | An array of scopes relevant to the single trust policy configured in notation verifier.                                                                                                                                                                                                                                                                                | `["*"]`                              |
| notation.trustPolicies[0].trustedIdentities        | An array of trusted identities relevant to the single trust policy configured in notation verifier.                                                                                                                                                                                                                                                                    | `["*"]`                              |
| notation.trustPolicies[0].trustStores              | An array of trust stores relevant to the single trust policy configured in notation verifier. Each trustStore is defined as [ca\|tsa\|signingAuthority]:[notationCerts[i]\|AzureKeyVault]. Example: ca:notationCerts[0]                                                                                                                                                | ``                                   |
| notation.trustPolicies[0].registryScopes           | An array of registryScopes relevant to the single trust policy configured in notation verifier.                                                                                                                                                                                                                                                                        | `["*"]`                              |
| cosign.enabled                                     | Enables/disables cosign tag-based signature lookup in ORAS store. MUST be set to true for cosign verification.                                                                                                                                                                                                                                                         | `true`                               |
| cosign.scopes                                      | An array of scopes relevant to the single trust policy configured in Cosign verifier. A scope of '*' is a global wildcard character to represent all images apply.                                                                                                                                                                                                     | `["*"]`                              |
| cosign.rekorURL                                    | URL string reference to remote rekor server. If not specified, implementation will default to use Rekor public good instance `https://rekor.sigstore.dev`.                                                                                                                                                                                                             | ``                                   |
| cosign.tLogVerify                                  | Enables/disables verification of presence of signature in Transparency log.                                                                                                                                                                                                                                                                                            | `true`                               |
| cosign.keyless.ctLogVerify                         | Enables/disables verification of presence of Secure Certificate Timestamp (SCT) in transparency log                                                                                                                                                                                                                                                                    | `true`                               |
| cosign.keyless.certificateIdentity                 | String certificate identity used for exact identity match during verification. Either `certificateIdentity` or `certificateIdentityRegExp` MUST be defined, but both cannot be defined at together                                                                                                                                                                     | ``                                   |
| cosign.keyless.certificateIdentityRegExp           | String certificate identity regular expression for identity matching during verification. Accepts the Go regular expression syntax described at https://golang.org/s/re2syntax. Either `certificateIdentity` or `certificateIdentityRegExp` MUST be defined, but both cannot be defined together                                                                       | ``                                   |
| cosign.keyless.certificateOIDCIssuer               | String certificate OIDC issuer for exact issuer matching during verification. Either `certificateOIDCIssuer` or `certificateOIDCIssuerRegExp` MUST be defined, but both cannot be defined together                                                                                                                                                                     | ``                                   |
| cosign.keyless.certificateOIDCIssuerRegExp         | String certificate OIDC issuer regular expression for issuer matching during verification. Accepts the Go regular expression syntax described at https://golang.org/s/re2syntax. Either `certificateOIDCIssuer` or `certificateOIDCIssuerRegExp` MUST be defined, but both cannot be defined together                                                                  | ``                                   |
| vulnerabilityreport.enabled                        | Enables/disables installation of vulnerability report verifier                                                                                                                                                                                                                                                                                                         | `false`                              |
| vulnerabilityreport.passthrough                    | Enables/disables passthrough. All validation except `maximumAge` are disregarded and report content is added to verifier report                                                                                                                                                                                                                                        | `false`                              |
| vulnerabilityreport.schemaURL                      | URL for JSON schema to validate report against                                                                                                                                                                                                                                                                                                                         | ``                                   |
| vulnerabilityreport.createdAnnotationName          | Overrides the default created annotation (`org.opencontainers.image.created`) to search for                                                                                                                                                                                                                                                                            | ``                                   |
| vulnerabilityreport.maximumAge                     | Maximum age report can be based on timestamp in stored at creation annotation. Formatted based on [time.Duration](https://pkg.go.dev/time#ParseDuration). A duration string is a possibly signed sequence of decimal numbers, each with optional fraction and a unit suffix, such as "300ms" or "24h". Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h". | ``                                   |
| vulnerabilityreport.notaryProjectSignatureRequired | Enables/disable notary project signature verification attached to vulnerability report. Refer to notation verifier [documentation](https://ratify.dev/docs/reference/crds/verifiers#notation) to install + configure keys.                                                                                                                                             | `false`                              |
| vulnerabilityreport.disallowedSeverities           | List of severities to disallow (strings). Common severities: `low`, `medium`, `high`, `critical`, `unknown`                                                                                                                                                                                                                                                            | `[]`                                 |
| vulnerabilityreport.denylistCVEs                   | List of CVE IDs that cannot exist in the vulnerability report                                                                                                                                                                                                                                                                                                          | `[]`                                 |
| sbom.enabled                                       | Enables/disables installation of sbom verification configuration                                                                                                                                                                                                                                                                                                       | `false`                              |
| sbom.notaryProjectSignatureRequired                | requires validation of sbom notation signature                                                                                                                                                                                                                                                                                                                         | `false`                              |
| sbom.disallowedLicenses                            | list of disallowed licenses                                                                                                                                                                                                                                                                                                                                            | []                                   |
| sbom.disallowedPackages                            | list of disallowed packages defined by package name and version. For example:  --set sbom.disallowedPackages[0].name="busybox" --set sbom.disallowedPackages[0].version="1.36.1-r0"                                                                                                                                                                                    | []                                   |
| resources.limits.cpu                               | CPU limits of Ratify Deployment                                                                                                                                                                                                                                                                                                                                        | `1000m`                              |
| resources.limits.memory                            | Memory limits of Ratify Deployment                                                                                                                                                                                                                                                                                                                                     | `512Mi`                              |
| resources.requests.cpu                             | CPU request of Ratify Deployment                                                                                                                                                                                                                                                                                                                                       | `600m`                               |
| resources.requests.memory                          | Memory request of Ratify Deployment                                                                                                                                                                                                                                                                                                                                    | `512Mi`                              |
| serviceAccount.create                              | Create new dedicated Ratify service account                                                                                                                                                                                                                                                                                                                            | `true`                               |
| serviceAccount.name                                | Name of Ratify service account to create                                                                                                                                                                                                                                                                                                                               | `ratify-admin`                       |
| serviceAccount.annotations                         | Annotations to add to the service account                                                                                                                                                                                                                                                                                                                              | `{}`                                 |
| gatekeeper.version                                 | Determines the Gatekeeper CRD versioning                                                                                                                                                                                                                                                                                                                               | `3.18.0`                             |
| gatekeeper.namespace                               | Namespace Gatekeeper is installed                                                                                                                                                                                                                                                                                                                                      | `gatekeeper-system`                  |
| instrumentation.metricsEnabled                     | Initializes the configured metrics provider                                                                                                                                                                                                                                                                                                                            | `true`                               |
| instrumentation.metricsType                        | Specifies the metrics provider type                                                                                                                                                                                                                                                                                                                                    | `prometheus`                         |
| instrumentation.metricsPort                        | The metrics server port on Ratify container                                                                                                                                                                                                                                                                                                                            | `8888`                               |
| oras.useHttp                                       | Disables TLS verification and uses `http` for registry communication (Note: use for development purposes ONLY)                                                                                                                                                                                                                                                         | `false`                              |
| oras.authProviders.azureWorkloadIdentityEnabled    | Enables Azure Workload Identity authentication provider                                                                                                                                                                                                                                                                                                                | `false`                              |
| oras.authProviders.azureManagedIdentityEnabled     | Enables Azure Managed Identity authentication provider                                                                                                                                                                                                                                                                                                                 | `false`                              |
| oras.authProviders.azureContainerRegistryEndpoints | List of Azure Container Registry endpoints that the configured store can access. Endpoint is either a fully qualified domain name or a wildcard domain name following [RFC 1034](https://www.ietf.org/rfc/rfc1034.txt)                                                                                                                                                 | `[]`                                 |
| oras.authProviders.k8secretsEnabled                | Enables kubernetes secrets authentication provider for registry interactions                                                                                                                                                                                                                                                                                           | `false`                              |
| oras.authProviders.awsEcrBasicEnabled              | Enables AWS ECR basic authentication provider                                                                                                                                                                                                                                                                                                                          | `false`                              |
| oras.authProviders.awsApiOverride.enabled          | Enables API URL overrides                                                                                                                                                                                                                                                                                                                                              | `false`                              |
| oras.authProviders.awsApiOverride.endpoint         | Overrides ECR endpoint                                                                                                                                                                                                                                                                                                                                                 | ``                                   |
| oras.authProviders.awsApiOverride.partition        | Overrides ECR partition in the endpoint URL                                                                                                                                                                                                                                                                                                                            | `aws`                                |
| oras.authProviders.awsApiOverride.region           | Overrides ECR region in the endpoint URL                                                                                                                                                                                                                                                                                                                               | ``                                   |
| oras.authProviders.alibabacloudAcrBasicEnabled     | Enables Alibaba Cloud ACR basic authentication provider                                                                                                                                                                                                                                                                                                                | `false`                              |
| oras.cache.enabled                                 | Enables ORAS store cache for ListReferrers and GetSubjectDescriptor. TTL-based cache may cause inconsistency between cache and data source. Please disable it if strong consistency is required.operations                                                                                                                                                             | `true`                               |
| oras.cache.ttl                                     | Sets the ttl for ORAS store in seconds. cache                                                                                                                                                                                                                                                                                                                          | `10`                                 |
| provider.tls.crt                                   | Ratify server's tls public certificate                                                                                                                                                                                                                                                                                                                                 | ``                                   |
| provider.tls.key                                   | Ratify server's tls private key                                                                                                                                                                                                                                                                                                                                        | ``                                   |
| provider.tls.caCert                                | Ratify server's CA public certificate. TLS certificate is generated using CA.                                                                                                                                                                                                                                                                                          | ``                                   |
| provider.tls.caKey                                 | Ratify server's CA private key.                                                                                                                                                                                                                                                                                                                                        | ``                                   |
| provider.tls.cabundle                              | Base64 encoded CA bundle used for the 'caBundle' property of the Provider CR of Gatekeeper. CRD                                                                                                                                                                                                                                                                        | ``                                   |
| provider.timeout.validationTimeoutSeconds          | Verify request handler timeout in seconds. This MUST match the configured Gatekeeper `validatingWebhookTimeoutSeconds`.                                                                                                                                                                                                                                                | `5`                                  |
| provider.timeout.mutationTimeoutSeconds            | Mutate request handler timeout in seconds. This MUST match the configured Gatekeeper `mutatingWebhookTimeoutSeconds`                                                                                                                                                                                                                                                   | `2`                                  |
| provider.cache.enabled                             | Enables/disables non-ORAS store caches such as request cache and authentication cache.                                                                                                                                                                                                                                                                                 | `true`                               |
| provider.cache.type                                | The cache provider for global cache. (use `dapr` for HA scenarios)                                                                                                                                                                                                                                                                                                     | `ristretto`                          |
| provider.cacheSizeMb                               | Local cache max size allocated (applicable only if `ristretto` cache type selected)                                                                                                                                                                                                                                                                                    | `256`                                |
| provider.ttl                                       | TTL in seconds of global cache                                                                                                                                                                                                                                                                                                                                         | `10s`                                |
| provider.name                                      | The state store provider name used with dapr (applicable only if `dapr` cache type selected)                                                                                                                                                                                                                                                                           | `dapr-redis`                         |
| provider.enableMutation                            | Enables/disables tag-to-digest mutation for all admission resource creations. It is highly recommended to enable mutation since the verified digest may be different from the one run.                                                                                                                                                                                 | `true`                               |
| podAnnotations                                     | Adds specified annotations to Ratify deployment                                                                                                                                                                                                                                                                                                                        | `{}`                                 |
| podLabels                                          | Adds specified labels to Ratify deployment                                                                                                                                                                                                                                                                                                                             | `{}`                                 |
| enableRuntimeDefaultSeccompProfile                 | Sets the container's `seccomp` profile to be RuntimeDefault                                                                                                                                                                                                                                                                                                            | `true`                               |
| healthPort                                         | Liveness & readiness probe's port for ratify container                                                                                                                                                                                                                                                                                                                 | `9099`                               |
| rbac.create                                        | Enable/disable RBAC roles for ratify manager                                                                                                                                                                                                                                                                                                                           | `true`                               |
| upgradeCRDs.enabled                                | Enable/disable Ratify CRD upgrades as pre-install chart hooks                                                                                                                                                                                                                                                                                                          | `true`                               |
| upgradeCRDs.extraRules                             | List of rules to add to Ratify CRD upgrade ClusterRole                                                                                                                                                                                                                                                                                                                 | `[]`                                 |
| crds.affinity                                      | Pod affinity for the upgrade CRD Job                                                                                                                                                                                                                                                                                                                                   | `{}`                                 |
| crds.tolerations                                   | Pod tolerations for the upgrade CRD Job                                                                                                                                                                                                                                                                                                                                | `[]`                                 |
| crds.nodeSelector                                  |                                                                                                                                                                                                                                                                                                                                                                        | `{kubernetes.io/os: linux}`          |
| crds.resources                                     | Resource limits/requests for ratify upgrade CRD job                                                                                                                                                                                                                                                                                                                    | ``                                   |
| crds.securityContext.allowPrivilegeEscalation      | Enables/disables privilege elevation for crd upgrade container                                                                                                                                                                                                                                                                                                         | `false`                              |
| crds.securityContext.capabilities.drop             | List of allowed capabilities for crd upgrade container                                                                                                                                                                                                                                                                                                                 | `['ALL']`                            |
| crds.securityContext.readOnlyRootFilesystem        | Enable/disable read-only filesystem for crd upgrade container                                                                                                                                                                                                                                                                                                          | `true`                               |
| crds.securityContext.runAsGroup                    | Sets user group context                                                                                                                                                                                                                                                                                                                                                | `65532`                              |
| crds.securityContext.runAsNonRoot                  | Enable/disable root user role                                                                                                                                                                                                                                                                                                                                          | `true`                               |
| crds.securityContext.runAsUser                     | Sets user context                                                                                                                                                                                                                                                                                                                                                      | `65532`                              |
| policy.useRego                                     | Enables/disable OPA rego policy CRD                                                                                                                                                                                                                                                                                                                                    | `false`                              |
| logger.formatter                                   | Type of log formatter. Can be set to `text`, `json` or `logstash` output                                                                                                                                                                                                                                                                                               | `text`                               |
| logger.level                                       | Sets the log level                                                                                                                                                                                                                                                                                                                                                     | `info`                               |
| logger.requestHeaders.traceIDHeaderName            | List of headers that include the trace ID in the external data requests to Ratify. The same headers will be passed to upstream services like remote registries. e.g. Set it to `x-ms-correlation-request-id` to trace across Azure.                                                                                                                                    | `[]`                                 |
| crl.cache.enabled                                  | Enables/disables CRL Cache                                                                                                                                                                                                                                                                                                                                             | `true`                               |
| featureFlags.RATIFY_CERT_ROTATION                  | Enables/disables tls certificate rotation                                                                                                                                                                                                                                                                                                                              | `false`                              |
| featureFlags.RATIFY_EXPERIMENTAL_HIGH_AVAILABILITY | **EXPERIMENTAL** Enables/disables high availability mode including distributed caching.                                                                                                                                                                                                                                                                                | `false`                              |
| azureWorkloadIdentity.clientId                     | ClientID of AAD application/Managed identity associated with Workload Identity                                                                                                                                                                                                                                                                                         | ``                                   |
| azureManagedIdentity.clientId                      | ClientID of Managed identity                                                                                                                                                                                                                                                                                                                                           | ``                                   |
| azureManagedIdentity.tenantId                      | TenantID of Managed Identity resource                                                                                                                                                                                                                                                                                                                                  | ``                                   |
| azurekeyvault.enabled                              | Enables/disables Azure Key Vault key management provider. If you are using a custom chart, certificate store should be referenced through a Verifier CR.                                                                                                                                                                                                               | `false`                              |
| azurekeyvault.vaultURI                             | Vault URI for Azure Key Vault                                                                                                                                                                                                                                                                                                                                          | ``                                   |
| azurekeyvault.tenantId                             | Tenant ID of the configured Azure Key Vault resource                                                                                                                                                                                                                                                                                                                   | ``                                   |
| azurekeyvault.certificates                         | An array of certificate objects identified by `name` and `version` (optional) stored in Azure Key Vault                                                                                                                                                                                                                                                                | `[]`                                 |
| azurekeyvault.keys                                 | An array of key objects identified by `name` and `version` (optional) stored in Azure Key Vault                                                                                                                                                                                                                                                                        | `[]`                                 |
| azurekeyvault.refreshInterval                      | time duration to refresh the certificates/keys. Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h". Example: 1h, 30m, 1h30m. If it's not set, the refresh functionality will be disabled.                                                                                                                                                                  | ``                                   |
| alibabacloudAcrConfig.defaultInstanceId            | Default instance ID of the Alibaba Cloud Registry where the target artifacts stored                                                                                                                                                                                                                                                                                    | ``                                   |
| alibabacloudAcrConfig.acrInstancesConfig           | When images need to be pulled from multiple instances of Aliababa Cloud Registry, the instanceName and instanceId of the instances need to be defined separately in the list, e.g.    acrInstancesConfig:<br/>  - instanceName: name1<br/>    instanceId: cri-xxx1<br/>  - instanceName: name2<br/>    instanceId: cri-xxx2<br />                                      | `[]`                                 |
| notationCert                                       | **DEPRECATED** Please switch to `notationCerts` to specify an array of verification certificates. Public certificate/certificate chain used to create inline certstore used by Notation verifier.                                                                                                                                                                      | ``                                   |
| akvCertConfig.enabled                              | **DEPRECATED** Please use `azurekeyvault.enabled` instead. Enables/disables Azure Key Vault certificate store. If you are using a custom chart, certificate store should be referenced through a Verifier CR. References in ConfigMap will not be correctly resolved.                                                                                                  | `false`                              |
| akvCertConfig.vaultURI                             | **DEPRECATED** Please use `azurekeyvault.vaultURI` instead. Vault URI for AKV configured                                                                                                                                                                                                                                                                               | ``                                   |
| akvCertConfig.cert1Name                            | **DEPRECATED** Please use `azurekeyvault.certificates` instead. Exact name of the certificate stored in AKV.                                                                                                                                                                                                                                                           | ``                                   |
| akvCertConfig.cert1Version                         | **DEPRECATED** Please use `azurekeyvault.certificates` instead. Exact version of certificate to use from AKV.certificates                                                                                                                                                                                                                                              | ``                                   |
| akvCertConfig.cert2Name                            | **DEPRECATED** Please use `azurekeyvault.certificates` instead. Exact name of the certificate stored in AKV.                                                                                                                                                                                                                                                           | ``                                   |
| akvCertConfig.cert2Version                         | **DEPRECATED** Please use `azurekeyvault.certificates` instead. Exact version of certificate to use from AKV.                                                                                                                                                                                                                                                          | ``                                   |
| akvCertConfig.certificates                         | **DEPRECATED** Please use `azurekeyvault.certificates` instead. An array of certificate objects identified by `name` and `version` stored in AKV                                                                                                                                                                                                                       | ``                                   |
| akvCertConfig.tenantId                             | **DEPRECATED** Please use `azurekeyvault.certificates` instead. TenantID of the configured AKV resource                                                                                                                                                                                                                                                                | ``                                   |
| cosign.key                                         | **DEPRECATED** Please use `cosignKeys` instead. Public key used by cosign verifier                                                                                                                                                                                                                                                                                     | ``                                   |
